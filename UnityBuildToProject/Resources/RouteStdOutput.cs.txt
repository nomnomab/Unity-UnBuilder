using System;
using System.Collections;
using System.IO;
using UnityEngine;
using UnityEditor;

namespace Nomnom {
    static class RouteStdOutput {
        private static ILogger logger = Debug.unityLogger;
        public static UtilLogger Logger;
        
        [InitializeOnLoadMethod]
        static void OnLoad() {
            logger.Log("Overriding Unity logger...");
            Logger = new UtilLogger();
        }
    }

    class UtilLogger : ILogHandler {
        private ILogHandler _unityLogHandler = Debug.unityLogger.logHandler;
        
        public UtilLogger() {
            Debug.unityLogger.logHandler = this;
        }
        
        public void LogFormat(LogType logType, UnityEngine.Object context, string format, params object[] args) {
            _unityLogHandler.LogFormat(logType, context, format, args);
            
            Console.WriteLine(string.Format("[{0}] {1}", logType, string.Format(format, args)));
        }

        public void LogException(Exception exception, UnityEngine.Object context) {
            _unityLogHandler.LogException(exception, context);
            
            var errorWriter = Console.Error;
            errorWriter.WriteLine(string.Format("[Exception] {0}", exception));
        }
    }
}
